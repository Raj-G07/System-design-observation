# Flyweight Design Pattern

## ğŸ“˜ Definition
The **Flyweight Design Pattern** is a **structural pattern** that minimizes memory usage by sharing as much data as possible with similar objects.  
Itâ€™s especially useful when an application uses a large number of similar objects that consume considerable memory.

---

## ğŸ¯ Intent
!!! tip ""
    - To **reduce memory footprint** by sharing common data among multiple objects.
    - To **separate intrinsic (shared)** and **extrinsic (unique)** states of objects.

---

## ğŸ§© Real-Life Analogy
Imagine a **text editor** showing thousands of characters.  
Each character doesnâ€™t need its own font, color, or style object â€” these can be shared among similar characters.  
Only the position (x, y) is unique per character.

---

## âš™ï¸ Key Concepts

!!! details ""
    | Type | Meaning |
    |------|----------|
    | **Intrinsic State** | Shared state â€” independent of context (e.g., character shape, font type) |
    | **Extrinsic State** | Context-specific state â€” depends on context (e.g., character position, color) |

---

## ğŸ“Š UML Diagram
!!! note ""
    ```mermaid
    classDiagram
        class Flyweight {
            <<interface>>
            +operation(extrinsicState)
        }
    
        class ConcreteFlyweight {
            -intrinsicState
            +operation(extrinsicState)
        }
    
        class FlyweightFactory {
            -flyweights : map<string, Flyweight*>
            +getFlyweight(key) Flyweight*
        }
    
        class Client {
            -extrinsicState
        }
    
        Flyweight <|.. ConcreteFlyweight
        FlyweightFactory --> Flyweight
        Client --> FlyweightFactory
    ```

---

## ğŸ’» C++ Implementation
```cpp title="flyweight-design.cpp" linenums="1"
#include <iostream>
#include <unordered_map>
#include <memory>
#include <string>
using namespace std;

// Flyweight Interface
class Shape {
public:
    virtual void draw(int x, int y) = 0;
    virtual ~Shape() = default;
};

// Concrete Flyweight
class Circle : public Shape {
    string color; // Intrinsic (shared) state
public:
    Circle(const string& c) : color(c) {}
    void draw(int x, int y) override {
        cout << "Drawing " << color << " circle at (" << x << ", " << y << ")\n";
    }
};

// Flyweight Factory
class ShapeFactory {
    unordered_map<string, shared_ptr<Shape>> circleMap;
public:
    shared_ptr<Shape> getCircle(const string& color) {
        auto it = circleMap.find(color);
        if (it != circleMap.end()) {
            return it->second; // Reuse existing
        }
        cout << "Creating new circle of color: " << color << endl;
        auto circle = make_shared<Circle>(color);
        circleMap[color] = circle;
        return circle;
    }
};

// Client Code
int main() {
    ShapeFactory factory;

    auto redCircle = factory.getCircle("Red");
    redCircle->draw(10, 20);

    auto blueCircle = factory.getCircle("Blue");
    blueCircle->draw(30, 40);

    auto anotherRed = factory.getCircle("Red"); // Shared
    anotherRed->draw(50, 60);

    return 0;
}
```

---

## ğŸ§  Output
```arduino
Creating new circle of color: Red
Drawing Red circle at (10, 20)
Creating new circle of color: Blue
Drawing Blue circle at (30, 40)
Drawing Red circle at (50, 60)
```

---

## âœ… Advantages

- Reduced memory usage via shared objects.
- Improved performance when dealing with large object sets.
- Simplifies management of large object pools.

---

## âš ï¸ Disadvantages

- Complex code structure due to separation of intrinsic and extrinsic states.
- Requires careful management of shared vs unique data.

---

## ğŸ’¡ Variants

- **Intrinsic State Sharing** â€” Core of the pattern (shared properties).

- **Extrinsic State Passing** â€” Passed from client at runtime.

- **Factory-Based Management** â€” Centralized object reuse.

## ğŸ”— References
???+ link 
     - [Refactoring Guru: Flyweight Pattern](https://refactoring.guru/design-patterns/flyweight)
     - [GeeksforGeeks: Flyweight Design Pattern](https://www.geeksforgeeks.org/system-design/flyweight-design-pattern/)
     - [Wikipedia: Flyweight Pattern](https://en.wikipedia.org/wiki/Flyweight_pattern)
